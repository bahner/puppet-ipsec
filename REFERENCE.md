# Reference
<!-- DO NOT EDIT: This document was generated by Puppet Strings -->

## Table of Contents

**Classes**

* [`ipsec`](#ipsec): Main entry point to this module.
* [`ipsec::config`](#ipsecconfig): Manage configuration file contents. Must not be instanciated for its own.
* [`ipsec::install`](#ipsecinstall): Do not use it separately
* [`ipsec::service`](#ipsecservice): Service management class for IPSec

**Defined types**

* [`ipsec::conf::ca`](#ipsecconfca): Create a ca section within ipsec.conf file.
* [`ipsec::conf::conn`](#ipsecconfconn): Create a ca section within ipsec.conf file.

**Data types**

* [`Ipsec::Secret`](#ipsecsecret): 
* [`Ipsec::Secret::Privkey`](#ipsecsecretprivkey): 
* [`Ipsec::Secret::Shared`](#ipsecsecretshared): 
* [`Ipsec::Secret::Smartcard`](#ipsecsecretsmartcard): 
* [`Ipsec::Time`](#ipsectime): 

## Classes

### ipsec

Puppet module for IPsec

This puppet module is providing facility to install and configure ipsec settings.
Currently using strongswan, it manages package installation, the contents of
configuration files ipsec.secrets and ipsec.conf and controlling the service itself
in order to reload configurations after changes. The module is designed to be fully
configurable through parameter lookup.

Secrets are added to the ipsec.secrets file through the secrets parameter of the
module. Consisting of an array of custom typed entries, all entries are added as
individual secret etries. Parameter secrets_includes provides the possibility to
include auxiliary secret files.

The contents of ipsec.conf, as it consists of three different types of entries, is
generated upon the fixed structure parameter named conf. As the setup section is
singleton within ipsec.conf, the conf['setup'] hash only includes the actual setup
key-value pairs. Entries ```conf['authorities']``` and ```conf['connections']``` are
processed in a factory pattern, creating the according resource instances, which build
the actual sections of the ipsec.conf file. The possibility of configuration fragments
placed in /etc/ipsec.d/ is not utilised.

* **See also**
https://wiki.strongswan.org/projects/strongswan/wiki/IpsecConf

#### Examples

##### specification of secrets

```puppet
ipsec::secrets:
  - selector: '@example.org'
    secret:
      type: PSK
      passphrase: 'asdf1234'
  - selector: 'rsa-a.example.org'
    secret:
      type: RSA
      private_key_file: '/etc/ipsec.d/private/host-a.key'
      prompt: true
  - selector: 'rsa-b.example.org'
    secret:
    type: RSA
     private_key_file: '/etc/ipsec.d/private/host-b.key'
     passphrase: 'asdf1234'
  - secret:
       type: RSA
       private_key_file: '/etc/ipsec.d/private/host-def.key'
  - secret:
       type: PIN
       slotnr: 1
       keyid: 50
       pin: 1234
  - secret:
       type: PIN
       slotnr: 1
       module: opensc
       keyid: 45
       prompt: true
```

##### secret includes

```puppet
ipsec::secret_includes:
   - '/var/lib/strongswan/ipsec.secrets.inc'
   - '/etc/ipsec.d/very.secret'
```

##### ca settings

```puppet
ipsec::conf::authorities:
  myca:
    auto: add
    cacert: /etc/ssl/certs/myca.pem
    crluri: file:///etc/ssl/crls/myca_crl.pem
```

##### conn settings

```puppet
ipsec::conf::connections:
  test:
    type: transport
    left: %any
    leftcert: hostcert.pem
    right: 192.168.56.1
    rightid: %any
    auto: route
```

##### 

```puppet
include ipsec
```

#### Parameters

The following parameters are available in the `ipsec` class.

##### `ensure`

Data type: `Enum['present', 'absent']`

ensure meta-parameter to add or remove config done by this module

##### `secrets`

Data type: `Array[Ipsec::Secret]`

array of secrets to be added to ipsec.secrets

##### `secret_includes`

Data type: `Array[Stdlib::Absolutepath]`

array of paths to files to be included to ipsec.secrets

##### `conf`

Data type: `Struct[{
    setup       => Optional[Hash[String,String]],
    authorities => Optional[Hash[String,Hash]],
    connections => Optional[Hash[String,Hash]],
  }]`

Hash of ipsec.conf entries; for details see IpsecConf documentation

### ipsec::config

ipsec::config

Manage configuration file contents. This includes the ipsec.secrets and ipsec.conf files.
Secrets file will, which contain many kind of secrets defined by ipsec::secrets parameter.
The conf file consists of multiple sections of types setup, ca and conn, where there is only
a single setup section allowed, but multiple ca and conn sections. Refer to custom type
Ipsec::Secret for details on the structure of this parameter.

Parameter ipsec::conf containes the data to generate these sections. The setup sectioin is
generated out of the entries found in ipsec::conf['setup'], while ipsec::conf['authorities']
and ipsec::conf['connections'] will create instances of the according resources ipsec::conf::ca
and ipsec::conf::conn respectively.

#### Examples

##### ipsec.secret setup

```puppet
ipsec::secrets:
  - selector: '@example.org'
    secret:
      type: PSK
      passphrase: 'asdf1234'
  - selector: 'rsa-a.example.org'
    secret:
      type: RSA
      private_key_file: '/etc/ipsec.d/private/host-a.key'
      prompt: true
  - selector: 'rsa-b.example.org'
    secret:
    type: RSA
     private_key_file: '/etc/ipsec.d/private/host-b.key'
     passphrase: 'asdf1234'
  - secret:
       type: RSA
       private_key_file: '/etc/ipsec.d/private/host-def.key'
  - secret:
       type: PIN
       slotnr: 1
       keyid: 50
       pin: 1234
  - secret:
       type: PIN
       slotnr: 1
       module: opensc
       keyid: 45
       prompt: true
ipsec::secret_includes:
   - '/var/lib/strongswan/ipsec.secrets.inc'
   - '/etc/ipsec.d/very.secret'
```

##### ca settings

```puppet
ipsec::conf::authorities:
  myca:
    auto: add
    cacert: /etc/ssl/certs/myca.pem
    crluri: file:///etc/ssl/crls/myca_crl.pem
```

##### conn settings

```puppet
ipsec::conf::connections:
  test:
    type: transport
    left: %any
    leftcert: hostcert.pem
    right: 192.168.56.1
    rightid: %any
    auto: route
```

#### Parameters

The following parameters are available in the `ipsec::config` class.

##### `secrets_file`

Data type: `Stdlib::Absolutepath`

path to ipsec.secrets file

##### `conf_file`

Data type: `Stdlib::Absolutepath`

path to ipsec.conf file

### ipsec::install

ipsec::install

Install necessary packages.

Do not use it separately.

#### Parameters

The following parameters are available in the `ipsec::install` class.

##### `packages`

Data type: `Array[String]`

package names to be installed

### ipsec::service

ipsec::service

Manage the service needed for ipsec operations. Do not include this class on its own.

#### Parameters

The following parameters are available in the `ipsec::service` class.

##### `service_name`

Data type: `String`

name of the service unit

##### `service_restart`

Data type: `String`

deprecated, do not set.

Default value: 'deprecated'

## Defined types

### ipsec::conf::ca

ipsec::conf::ca

All instances of ipsec::conf::ca resource will create ca sections within ipsec.conf file.
However, ipsec::conf does contain a factory which creates these instanses from parameter
ipsec::conf['authorities'], it is allowed to create instances directly.

The resource takes parameter as described in Strongswan documentation (see link below).

* **See also**
https://wiki.strongswan.org/projects/strongswan/wiki/CaSection

#### Examples

##### 

```puppet
ipsec::conf::ca { 'myca':
  auto   => 'add',
  cacert => '/etc/ssl/certs/myca.pem',
  crluri => 'file:///etc/ssl/crls/myca_crl.pem'
}
```

#### Parameters

The following parameters are available in the `ipsec::conf::ca` defined type.

##### `also`

Data type: `Optional[String]`



Default value: `undef`

##### `auto`

Data type: `Optional[Enum['ignore','add']]`



Default value: `undef`

##### `cacert`

Data type: `Optional[String]`



Default value: `undef`

##### `crluri`

Data type: `Optional[String]`



Default value: `undef`

##### `crluri2`

Data type: `Optional[String]`



Default value: `undef`

##### `ocspuri`

Data type: `Optional[String]`



Default value: `undef`

##### `ocspuri2`

Data type: `Optional[String]`



Default value: `undef`

##### `certuribase`

Data type: `Optional[String]`



Default value: `undef`

##### `ldaphost`

Data type: `Optional[String]`



Default value: `undef`

### ipsec::conf::conn

ipsec::conf::conn
All instances of ipsec::conf::ca resource will create ca sections within ipsec.conf file.
However, ipsec::conf does contain a factory which creates these instanses from parameter
ipsec::conf['authorities'], it is allowed to create instances directly.

The resource takes parameter as described in Strongswan documentation (see link below).

* **See also**
https://wiki.strongswan.org/projects/strongswan/wiki/CaSection

#### Examples

##### 

```puppet
ipsec::conf::conn { 'test':
   type     => 'transport',
   left     => '%any'
   leftcert => 'hostcert.pem',
   right    => '192.168.56.1',
   rightid  => '%any',
   auto     => 'route',
}
```

#### Parameters

The following parameters are available in the `ipsec::conf::conn` defined type.

##### `aaa_identity`

Data type: `Optional[String]`



Default value: `undef`

##### `ah`

Data type: `Optional[String]`



Default value: `undef`

##### `aggressive`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `also`

Data type: `Optional[String]`



Default value: `undef`

##### `authby`

Data type: `Optional[Enum[
    'pubkey',
    'rsasig',
    'ecdsasig',
    'pdk',
    'secret',
    'xauthrsasig',
    'xauthpsk',
    'never'
  ]]`



Default value: `undef`

##### `auto`

Data type: `Optional[Enum[
    'ignore',
    'add',
    'route',
    'start'
  ]]`



Default value: `undef`

##### `closeaction`

Data type: `Optional[Enum[
    'none',
    'clear',
    'hold',
    'restart'
  ]]`



Default value: `undef`

##### `compress`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `dpdaction`

Data type: `Optional[Enum[
    'none',
    'clear',
    'hold',
    'restart'
  ]]`



Default value: `undef`

##### `dpddelay`

Data type: `Optional[Ipsec::Time]`



Default value: `undef`

##### `dpdtimeout`

Data type: `Optional[Ipsec::Time]`



Default value: `undef`

##### `inactivity`

Data type: `Optional[Ipsec::Time]`



Default value: `undef`

##### `eap_identity`

Data type: `Optional[String]`



Default value: `undef`

##### `esp`

Data type: `Optional[String]`



Default value: `undef`

##### `forceencaps`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `fragmentation`

Data type: `Optional[Enum[
    'yes',
    'accept',
    'force',
    'no'
  ]]`



Default value: `undef`

##### `ike`

Data type: `Optional[String]`



Default value: `undef`

##### `ikedscp`

Data type: `Optional[
    Pattern[/^[0-9]{6}$/]
  ]`



Default value: `undef`

##### `ikelifetime`

Data type: `Optional[Ipsec::Time]`



Default value: `undef`

##### `installpolicy`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `keyexchange`

Data type: `Optional[Enum[
    'ike',
    'ikev1',
    'ikev2'
  ]]`



Default value: `undef`

##### `keyingtries`

Data type: `Optional[String]`



Default value: `undef`

##### `lifebytes`

Data type: `Optional[Integer]`



Default value: `undef`

##### `lifepackets`

Data type: `Optional[Integer]`



Default value: `undef`

##### `lifetime`

Data type: `Optional[Ipsec::Time]`



Default value: `undef`

##### `marginbytes`

Data type: `Optional[Integer]`



Default value: `undef`

##### `marginpackets`

Data type: `Optional[Integer]`



Default value: `undef`

##### `margintime`

Data type: `Optional[Ipsec::Time]`



Default value: `undef`

##### `mark`

Data type: `Optional[String]`



Default value: `undef`

##### `mark_in`

Data type: `Optional[String]`



Default value: `undef`

##### `mark_out`

Data type: `Optional[String]`



Default value: `undef`

##### `mobike`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `modeconfig`

Data type: `Optional[Enum[
    'push',
    'pull'
  ]]`



Default value: `undef`

##### `reauth`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `rekey`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `rekeyfuzz`

Data type: `Optional[String]`



Default value: `undef`

##### `replay_window`

Data type: `Optional[Integer]`



Default value: `undef`

##### `reqid`

Data type: `Optional[Integer]`



Default value: `undef`

##### `sha256_96`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `tfc`

Data type: `Optional[Integer]`



Default value: `undef`

##### `type`

Data type: `Optional[Enum[
    'tunnel',
    'transport',
    'transport_proxy',
    'passthrough',
    'drop'
  ]]`



Default value: `undef`

##### `xauth`

Data type: `Optional[Enum[
    'client',
    'server'
  ]]`



Default value: `undef`

##### `xauth_identity`

Data type: `Optional[String]`



Default value: `undef`

##### `left`

Data type: `Optional[String]`



Default value: `undef`

##### `right`

Data type: `Optional[String]`



Default value: `undef`

##### `leftallowany`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `rightallowany`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `leftauth`

Data type: `Optional[String]`



Default value: `undef`

##### `rightauth`

Data type: `Optional[String]`



Default value: `undef`

##### `leftauth2`

Data type: `Optional[String]`



Default value: `undef`

##### `rightauth2`

Data type: `Optional[String]`



Default value: `undef`

##### `leftca`

Data type: `Optional[String]`



Default value: `undef`

##### `rightca`

Data type: `Optional[String]`



Default value: `undef`

##### `leftca2`

Data type: `Optional[String]`



Default value: `undef`

##### `rightca2`

Data type: `Optional[String]`



Default value: `undef`

##### `leftcert`

Data type: `Optional[String]`



Default value: `undef`

##### `rightcert`

Data type: `Optional[String]`



Default value: `undef`

##### `leftcert2`

Data type: `Optional[String]`



Default value: `undef`

##### `rightcert2`

Data type: `Optional[String]`



Default value: `undef`

##### `leftcertpolicy`

Data type: `Optional[String]`



Default value: `undef`

##### `rightcertpolicy`

Data type: `Optional[String]`



Default value: `undef`

##### `leftdns`

Data type: `Optional[String]`



Default value: `undef`

##### `rightdns`

Data type: `Optional[String]`



Default value: `undef`

##### `leftfirewall`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `rightfirewall`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `leftgroups`

Data type: `Optional[String]`



Default value: `undef`

##### `rightgroups`

Data type: `Optional[String]`



Default value: `undef`

##### `leftgroups2`

Data type: `Optional[String]`



Default value: `undef`

##### `rightgroups2`

Data type: `Optional[String]`



Default value: `undef`

##### `lefthostaccess`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `righthostaccess`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `leftid`

Data type: `Optional[String]`



Default value: `undef`

##### `rightid`

Data type: `Optional[String]`



Default value: `undef`

##### `leftid2`

Data type: `Optional[String]`



Default value: `undef`

##### `rightid2`

Data type: `Optional[String]`



Default value: `undef`

##### `leftikeport`

Data type: `Optional[Integer]`



Default value: `undef`

##### `rightikeport`

Data type: `Optional[Integer]`



Default value: `undef`

##### `leftprotoport`

Data type: `Optional[String]`



Default value: `undef`

##### `rightprotoport`

Data type: `Optional[String]`



Default value: `undef`

##### `leftrsasigkey`

Data type: `Optional[String]`



Default value: `undef`

##### `rightrsasigkey`

Data type: `Optional[String]`



Default value: `undef`

##### `leftsigkey`

Data type: `Optional[String]`



Default value: `undef`

##### `rightsigkey`

Data type: `Optional[String]`



Default value: `undef`

##### `leftsendcert`

Data type: `Optional[String]`



Default value: `undef`

##### `rightsendcert`

Data type: `Optional[String]`



Default value: `undef`

##### `leftsourceip`

Data type: `Optional[String]`



Default value: `undef`

##### `rightsourceip`

Data type: `Optional[String]`



Default value: `undef`

##### `leftsubnet`

Data type: `Optional[String]`



Default value: `undef`

##### `rightsubnet`

Data type: `Optional[String]`



Default value: `undef`

##### `leftupdown`

Data type: `Optional[String]`



Default value: `undef`

##### `rightupdown`

Data type: `Optional[String]`



Default value: `undef`

##### `mediation`

Data type: `Optional[Enum['yes','no']]`



Default value: `undef`

##### `mediated_by`

Data type: `Optional[String]`



Default value: `undef`

##### `me_peerid`

Data type: `Optional[String]`



Default value: `undef`

## Data types

### Ipsec::Secret

The Ipsec::Secret data type.

Alias of `Struct[{
  selector => Optional[Pattern[/[^:]*/]],
  secret   => Variant[
    Ipsec::Secret::Privkey,
    Ipsec::Secret::Shared,
    Ipsec::Secret::Smartcard,
    # Ipsec::Secret::NTLM,
    # Ipsec::Secret::Bliss,
  ],
}]`

### Ipsec::Secret::Privkey

The Ipsec::Secret::Privkey data type.

Alias of `Struct[{
  type             => Enum['RSA','ECDSA','P12'],
  private_key_file => String,
  prompt           => Optional[Boolean],
  passphrase       => Optional[String],
}]`

### Ipsec::Secret::Shared

The Ipsec::Secret::Shared data type.

Alias of `Struct[{
  type       => Enum['PSK','EAP','XAUTH'],
  passphrase => String,
}]`

### Ipsec::Secret::Smartcard

The Ipsec::Secret::Smartcard data type.

Alias of `Struct[{
  type   => Enum['PIN'],
  slotnr => Optional[Integer],
  module => Optional[String],
  keyid  => Integer,
  pin    => Optional[Integer],
  prompt => Optional[Boolean],
}]`

### Ipsec::Time

The Ipsec::Time data type.

Alias of `Variant[Integer, Pattern[/^[0-9]+[smhd]?$/]]`

