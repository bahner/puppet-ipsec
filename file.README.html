<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.9
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-ipsec">ipsec</h1>

<p><a href="https://travis-ci.org/rtib/puppet-ipsec"><img
src="https://travis-ci.org/rtib/puppet-ipsec.svg?branch=master"></a> <a
href="https://github.com/rtib/puppet-ipsec/issues"><img
src="https://img.shields.io/github/issues/rtib/puppet-ipsec.svg"></a> <a
href="https://github.com/rtib/puppet-ipsec/blob/master/LICENSE"><img
src="https://img.shields.io/github/license/rtib/puppet-ipsec.svg"></a></p>

<h2 id="label-Table+of+Contents">Table of Contents</h2>
<ol><li>
<p><a href="#description">Description</a></p>
</li><li>
<p><a href="#setup">Setup - The basics of getting started with ipsec</a></p>
</li><li>
<p><a href="#usage">Usage - Configuration options and additional
functionality</a></p>
<ul><li>
<p><a href="#defining-secrets">Defining secrets</a></p>
</li><li>
<p><a href="#creating-configuration">Creating configuration</a></p>
</li><li>
<p><a href="#setup-section">Setup section</a></p>
</li><li>
<p><a href="#authority-sections">Authority sections</a></p>
</li><li>
<p><a href="#connection-sections">Connection sections</a></p>
</li></ul>
</li><li>
<p><a href="#reference">Reference - An under-the-hood peek at what the module
is doing and how</a></p>
</li><li>
<p><a href="#limitations">Limitations - OS compatibility, etc.</a></p>
</li><li>
<p><a href="#development">Development - Guide for contributing to the
module</a></p>
</li></ol>

<h2 id="label-Description">Description</h2>

<p>This puppet module is providing facility to install and configure ipsec
settings. Currently using strongswan, it manages package installation, the
contents of configuration files ipsec.secrets and ipsec.conf and
controlling the service itself in order to reload configurations after
changes. The module is designed to be fully configurable through parameter
lookup, but it also allowes you to manage configuration artefacts via
resource instances.</p>

<h2 id="label-Setup">Setup</h2>

<h3 id="label-Beginning+with+ipsec">Beginning with ipsec</h3>

<p>The very basic steps needed for a user to get the module up and running.
This can include setup steps, if necessary, or it can be an example of the
most basic use of the module.</p>

<h2 id="label-Usage">Usage</h2>

<p>To get startet with this module, simply include the module into your puppet
manifest. Passing parameter values may happen by direct assignment or
preferably via lookup.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_ipsec'>ipsec</span>
</code></pre>

<p>The module will install strongswan on the affected nodes and care about the
service to be enabled.</p>

<h3 id="label-Defining+secrets">Defining secrets</h3>

<p>To add your secrets to the <code>ipsec.secrets</code> file, there are two
options. Passing the actual secrets to the module via
<code>ipsec::secrets</code> parameter or adding includes to the secrets
file and file the secrets through other tools.</p>

<pre class="code ruby"><code class="ruby">ipsec::secrets:
  - selector: &#39;@example.org&#39;
    secret:
      type: PSK
      passphrase: &#39;asdf1234&#39;
  - selector: &#39;rsa-a.example.org&#39;
    secret:
      type: RSA
      private_key_file: &#39;/etc/ipsec.d/private/host-a.key&#39;
      prompt: true
  - selector: &#39;rsa-b.example.org&#39;
    secret:
      type: RSA
      private_key_file: &#39;/etc/ipsec.d/private/host-b.key&#39;
      passphrase: &#39;asdf1234&#39;
  - secret:
      type: RSA
      private_key_file: &#39;/etc/ipsec.d/private/host-def.key&#39;
  - secret:
      type: PIN
      slotnr: 1
      keyid: 50
      pin: 1234
  - secret:
      type: PIN
      slotnr: 1
      module: opensc
      keyid: 45
      prompt: true</code></pre>

<p>Note, that non of the above used secrets (passphrase or pin fields) are
treated as sensitive content.</p>

<p>The other option is to use parameter <code>ipsec::secret_includes</code> to
include files.</p>

<pre class="code ruby"><code class="ruby">ipsec::secret_includes:
  - &#39;/var/lib/strongswan/ipsec.secrets.inc&#39;
  - &#39;/etc/ipsec.d/very.secret&#39;</code></pre>

<h3 id="label-Creating+configuration">Creating configuration</h3>

<p>IPSec configuration is handled within <code>ipsec.conf</code> file. This
consists of sections of three types. All sections can be handled via
<code>ipsec::conf</code> parameter. The setup secion is a singleton
section, therefore it is handled only via the conf parameter.</p>

<h4 id="label-Setup+section">Setup section</h4>

<p>The hash passed in through <code>ipsec::conf['setup']</code> is placed as
key-value pairs into the setup section of the <code>ipsec.conf</code> file.</p>

<h4 id="label-Authority+sections">Authority sections</h4>

<p>The <code>ipsec.conf</code> file may contain multiple ca sections each
configuring a certification authority. These section may be created via
<code>ipsec::conf['authorities']</code> parameter.</p>

<pre class="code ruby"><code class="ruby">ipsec::conf:
  authorities:
    myca:
      auto: add
      cacert: &#39;/etc/ssl/certs/myca.pem&#39;
      crluri: &#39;file:///etc/ssl/crls/myca_crl.pem&#39;</code></pre>

<p>Alternatively, ca sections can be created by resource instances of type
<code>ipsec::conf::ca</code>.</p>

<pre class="code ruby"><code class="ruby">ipsec::conf::ca { &#39;myca&#39;:
  auto   =&gt; &#39;add&#39;,
  cacert =&gt; &#39;/etc/ssl/certs/myca.pem&#39;,
  crluri =&gt; &#39;file:///etc/ssl/crls/myca_crl.pem&#39;</code></pre>

<h4 id="label-Connection+sections">Connection sections</h4>

<p>Connections sections are created similar to authority sections. Resource
instances of <code>ipsec::conf::conn</code> are created automatically from
<code>ipsec::conf['connections']</code> hash parameter, or may be created
directly within your puppet code.</p>

<pre class="code ruby"><code class="ruby">ipsec::conf:
  connections:
    test:
      type: transport
      left: %any
      leftcert: hostcert.pem
      right: 192.168.56.1
      rightid: %any
      auto: route</code></pre>

<pre class="code ruby"><code class="ruby">ipsec::conf::conn { &#39;test&#39;:
  type     =&gt; &#39;transport&#39;,
  left     =&gt; &#39;%any&#39;
  leftcert =&gt; &#39;hostcert.pem&#39;,
  right    =&gt; &#39;192.168.56.1&#39;,
  rightid  =&gt; &#39;%any&#39;,
  auto     =&gt; &#39;route&#39;,
}</code></pre>

<h2 id="label-Reference">Reference</h2>
<ul><li>
<p>Reference documentation is created by Puppet Strings code comments, and
published as gh_pages at [<a
href="https://rtib.github.io/puppet-ipsec">rtib.github.io/puppet-ipsec</a>/].</p>
</li></ul>

<h3 id="label-Data+types">Data types</h3>

<p>The module introduces some custom data types, which are not contained in
the above reference.</p>

<h4 id="label-Ipsec-3A-3ATime">Ipsec::Time</h4>

<p>Represents a time value as used in Strongswan configuration. Consisting of
one or more numerals and an optional suffix, which designate the dimensions
of seconds (s), minutes (m), hours (h) or days (d).</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_type'>type</span> <span class='const'>Ipsec</span><span class='op'>::</span><span class='const'>Time</span> <span class='op'>=</span> <span class='const'>Pattern</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^[0-9]+[smhd]?$</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span>
</code></pre>

<h4 id="label-Ipsec-3A-3ASecret">Ipsec::Secret</h4>

<p>The custom data structure to handle different types of secrets
configuration for Strongswan is a bit more complex. It consists of an
optional selector and a secret, which is a varian of some sub-types. The
outer structure is defined as</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_type'>type</span> <span class='const'>Ipsec</span><span class='op'>::</span><span class='const'>Secret</span> <span class='op'>=</span> <span class='const'>Struct</span><span class='lbracket'>[</span><span class='lbrace'>{</span>
  <span class='id identifier rubyid_selector'>selector</span> <span class='op'>=&gt;</span> <span class='const'>Optional</span><span class='lbracket'>[</span><span class='const'>Pattern</span><span class='lbracket'>[</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[^:]*</span><span class='regexp_end'>/</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='id identifier rubyid_secret'>secret</span>   <span class='op'>=&gt;</span> <span class='const'>Variant</span><span class='lbracket'>[</span>
    <span class='const'>Ipsec</span><span class='op'>::</span><span class='const'>Secret</span><span class='op'>::</span><span class='const'>Privkey</span><span class='comma'>,</span>
    <span class='const'>Ipsec</span><span class='op'>::</span><span class='const'>Secret</span><span class='op'>::</span><span class='const'>Shared</span><span class='comma'>,</span>
    <span class='const'>Ipsec</span><span class='op'>::</span><span class='const'>Secret</span><span class='op'>::</span><span class='const'>Smartcard</span><span class='comma'>,</span>
  <span class='rbracket'>]</span><span class='comma'>,</span>
<span class='rbrace'>}</span><span class='rbracket'>]</span>
</code></pre>

<p>Each sub-type does have a mandatory field named type, which may decide on
the applicability of the particular type.</p>

<h4 id="label-Ipsec-3A-3ASecret-3A-3AShared">Ipsec::Secret::Shared</h4>

<p>The custom type for shared secrets is handling types <code>PSK</code>,
<code>EAP</code> and <code>XAUTH</code> and storing the passphrase as
string.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_type'>type</span> <span class='const'>Ipsec</span><span class='op'>::</span><span class='const'>Secret</span><span class='op'>::</span><span class='const'>Shared</span> <span class='op'>=</span> <span class='const'>Struct</span><span class='lbracket'>[</span><span class='lbrace'>{</span>
  <span class='id identifier rubyid_type'>type</span>       <span class='op'>=&gt;</span> <span class='const'>Enum</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>PSK</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>EAP</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>XAUTH</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='id identifier rubyid_passphrase'>passphrase</span> <span class='op'>=&gt;</span> <span class='const'>String</span><span class='comma'>,</span>
<span class='rbrace'>}</span><span class='rbracket'>]</span>
</code></pre>

<p>Note! The passphrase is not treated as sensitive data. Use this feature of
the module with care, only in the case no other solution is possible. The
secrets_include parameter is providing feature to ipsec.secrets which may
support other solutions for handling secret passphrase.</p>

<h4 id="label-Ipsec-3A-3ASecret-3A-3APrivkey">Ipsec::Secret::Privkey</h4>

<p>Private key type secrets has one of types <code>RSA</code>,
<code>ECDSA</code> or <code>P12</code>. All Privkey secrets does need a
private_key_file pointing to the file path the secret key is found. It the
private key needs to be unlocked, a passphrase may be filed or the prompt
option enabled.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_type'>type</span> <span class='const'>Ipsec</span><span class='op'>::</span><span class='const'>Secret</span><span class='op'>::</span><span class='const'>Privkey</span> <span class='op'>=</span> <span class='const'>Struct</span><span class='lbracket'>[</span><span class='lbrace'>{</span>
  <span class='id identifier rubyid_type'>type</span>             <span class='op'>=&gt;</span> <span class='const'>Enum</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>RSA</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ECDSA</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>P12</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='id identifier rubyid_private_key_file'>private_key_file</span> <span class='op'>=&gt;</span> <span class='const'>Stdlib</span><span class='op'>::</span><span class='const'>Absolutepath</span><span class='comma'>,</span>
  <span class='id identifier rubyid_prompt'>prompt</span>           <span class='op'>=&gt;</span> <span class='const'>Optional</span><span class='lbracket'>[</span><span class='const'>Boolean</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='id identifier rubyid_passphrase'>passphrase</span>       <span class='op'>=&gt;</span> <span class='const'>Optional</span><span class='lbracket'>[</span><span class='const'>String</span><span class='rbracket'>]</span><span class='comma'>,</span>
<span class='rbrace'>}</span><span class='rbracket'>]</span>
</code></pre>

<p>Note! The passphrase is not treated as sensitive data. Use this feature
with care, only in the case no other solution is possible. The
secrets_include parameter is providing feature to ipsec.secrets which may
support other solutions for handling secret passphrase.</p>

<h4 id="label-Ipsec-3A-3ASecret-3A-3ASmartcard">Ipsec::Secret::Smartcard</h4>

<p>Smartcard based authentication is supported by a secret with type
<code>PIN</code>, which mandatory takes a keyid parameter, and optional the
slotnr, module name. If the card needs to be unlocked, a pin may be filed
or the prompt option enabled.</p>

<pre class="code ruby"><code class="ruby">type Ipsec::Secret::Smartcard = Struct[{
  type   =&gt; Enum[&#39;PIN&#39;],
  slotnr =&gt; Optional[Integer],
  module =&gt; Optional[String],
  keyid  =&gt; Integer,
  pin    =&gt; Optional[Integer],
  prompt =&gt; Optional[Boolean],
}]</code></pre>

<p>Note! The pin is not treated as sensitive data. Use this feature with care,
only in the case no other solution is possible. The secrets_include
parameter is providing feature to ipsec.secrets which may support other
solutions for handling secret pin.</p>

<h2 id="label-Limitations">Limitations</h2>

<p>The module is currently tested for a few OS distributions only and needs
contribution to be ported and tested on others. There are features
Strongswan is providing but cannot be configured with this module, e.g.
NTLM based authentication. Feel free to contribute missing features.</p>

<h2 id="label-Development">Development</h2>

<p>Since your module is awesome, other users will want to play with it. Let
them know what the ground rules for contributing are.</p>

<h2 id="label-Release+Notes-2FContributors-2FEtc.+Optional">Release Notes/Contributors/Etc. <strong>Optional</strong></h2>

<p>If you aren&#39;t using changelog, put your release notes here (though you
should consider using changelog). You can also add any additional sections
you feel are necessary or important to include here. Please use the
<code>##</code> header.</p>
</div></div>

      <div id="footer">
  Generated on Thu Nov 16 11:01:06 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.9 (ruby-2.4.2).
</div>

    </div>
  </body>
</html>